<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>说几句</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- [重构] 应用了新的布局和组件class -->
    <header class="main-header">
        <div class="logo">说几句</div>
        <div class="header-actions">
            <div class="search-bar">
                <input type="text" id="search-input" class="control-input search-bar_input" placeholder="搜索日记...">
                <button id="clear-search-btn" class="icon-btn hidden" title="清除搜索">&times;</button>
            </div>
            <button id="open-entry-form-btn" class="btn btn-primary">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                写新日记
            </button>
            <button id="toggle-3d-view-btn" class="icon-btn" title="3D日记本">
                <svg viewBox="0 0 24 24"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/></svg>
            </button>
            <button id="profile-btn" class="icon-btn" title="我的主页">
                <div id="header-avatar-display" class="profile-avatar"></div>
            </button>
            <button id="settings-btn" class="icon-btn" title="设置">
                <svg viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69-.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12-.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23-.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
            </button>
        </div>
    </header>

    <div class="main-container">
        <div id="diary-thread" class="diary-thread"></div>
        <div id="diary-book-3d" class="hidden">
            <div class="book-wrapper">
                <div class="book-cover"></div>
                <div class="book-pages">
                    <div class="pages-container"></div>
                </div>
            </div>
            <div class="book-controls">
                <button id="prev-page-btn" class="btn btn-secondary">上一页</button>
                <span id="current-page">封面</span>
                <button id="next-page-btn" class="btn btn-secondary">下一页</button>
                <button id="close-book-btn" class="btn">返回列表</button>
            </div>
        </div>
    </div>

    <!-- 模态框区域 -->

    <!-- 写日记模态框 -->
    <div id="entry-form-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="entry-form-title" class="modal-title">记录此刻的想法...</h3>
                <button id="close-entry-form-btn" class="icon-btn">&times;</button>
            </div>
            <div class="modal-body">
                <textarea id="diary-textarea" class="control-textarea" placeholder="今天发生了什么有意思的事吗？"></textarea>
                <div id="tags-input-container" class="hidden" style="margin-top: 16px;">
                    <input type="text" id="entry-tags-input" class="control-input" placeholder="标签 (多个请用逗号 ', ' 分隔)">
                </div>
                <input type="hidden" id="editing-entry-id">
            </div>
            <div class="modal-footer">
                <button id="toggle-tags-input-btn" class="btn btn-secondary" style="margin-right: auto;" title="添加/编辑标签"># 标签</button>
                <button id="save-entry-btn" class="btn btn-primary">发布</button>
            </div>
        </div>
    </div>

    <!-- 确认删除模态框 -->
    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">确认删除</h3>
            </div>
            <div class="modal-body">
                <p>你确定要删除这篇日记吗？此操作无法撤销。</p>
            </div>
            <div class="modal-footer">
                <button id="cancel-delete-btn" class="btn btn-secondary">取消</button>
                <button id="confirm-delete-btn" class="btn btn-primary" style="background-color: var(--c-danger);">确认删除</button>
            </div>
        </div>
    </div>
    
    <!-- 我的主页模态框 -->
    <div id="profile-modal" class="modal-overlay">
        <div class="modal-content">
             <div class="modal-header">
                <h3 class="modal-title">我的主页</h3>
                <button id="close-profile-btn" class="icon-btn">&times;</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <div id="profile-display-avatar" class="profile-avatar" style="width: 100px; height: 100px; font-size: 3rem; margin: 0 auto 16px; border-width: 4px;"></div>
                <h2 id="profile-display-name" style="margin: 0; font-size: 24px;">匿名用户</h2>
                <p id="profile-display-signature" style="color: var(--c-text-3); margin: 8px 0 24px;">这个人很神秘...</p>
                 <div style="display: flex; justify-content: space-around; background: var(--c-surface-hover); padding: 16px; border-radius: var(--radius-md);">
                    <div class="stat-item"><div id="total-entries" style="font-size:20px; font-weight: 700;">0</div><div style="font-size:12px; color: var(--c-text-3);">总日记</div></div>
                    <div class="stat-item"><div id="total-words" style="font-size:20px; font-weight: 700;">0</div><div style="font-size:12px; color: var(--c-text-3);">总字数</div></div>
                    <div class="stat-item"><div id="latest-entry" style="font-size:20px; font-weight: 700;">-</div><div style="font-size:12px; color: var(--c-text-3);">最近更新</div></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="edit-profile-btn" class="btn btn-primary">编辑资料</button>
            </div>
        </div>
    </div>
    
    <!-- 编辑个人资料模态框 -->
    <div id="edit-profile-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">编辑个人资料</h3>
                <button id="cancel-edit-profile-btn" class="icon-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                     <div id="profile-avatar-upload-trigger" title="点击更换头像" style="cursor: pointer; width: 80px; height: 80px; flex-shrink: 0;"><div id="profile-avatar-preview-area" class="profile-avatar" style="width: 100%; height: 100%; font-size: 2.5rem; border-width: 3px;"></div></div>
                     <p style="color: var(--c-text-2);">点击头像更换图片。推荐使用正方形图片。</p>
                     <input type="file" id="profile-avatar-file-input" class="hidden" accept="image/*">
                </div>
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    <div><label for="profile-username-input" style="display: block; margin-bottom: 8px;">昵称</label><input type="text" id="profile-username-input" class="control-input" placeholder="你的昵称"></div>
                    <div><label for="profile-signature-input" style="display: block; margin-bottom: 8px;">个性签名</label><textarea id="profile-signature-input" rows="2" class="control-textarea" placeholder="说说你的座右铭或今日心情"></textarea></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-profile-btn" class="btn btn-primary">保存</button>
            </div>
        </div>
    </div>

    <!-- 应用设置模态框 -->
    <div id="settings-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">应用设置</h3>
                <button id="close-settings-btn" class="icon-btn">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div class="settings-layout">
                    <nav class="settings-nav">
                        <ul id="settings-nav-list">
                            <li data-target="settings-appearance" class="active">主题与字体</li>
                            <li data-target="settings-display">显示偏好</li>
                            <li data-target="settings-data">数据管理</li>
                        </ul>
                    </nav>
                    <div style="padding: var(--space-lg); flex-grow: 1; overflow-y: auto;">
                        <!-- 主题与字体面板 -->
                        <div id="settings-appearance" class="settings-panel active">
                            <h4>主题选择</h4>
                            <div class="theme-grid" style="margin-bottom: 24px;">
                                <!-- Theme options will be populated by JS or hardcoded here -->
                                <div class="theme-option active" data-theme="light" style="border: 2px solid var(--c-primary);"><div style="height: 50px; background: #f8f9fa;"></div><span style="display: block; padding: 8px; text-align: center;">明亮</span></div>
                                <div class="theme-option" data-theme="dark"><div style="height: 50px; background: #121212;"></div><span style="display: block; padding: 8px; text-align: center;">暗黑</span></div>
                            </div>
                            <div class="font-control-group">
                                <h4>主界面字体</h4>
                                <div class="font-control-item"><label for="main-font-select">字体</label><select id="main-font-select" class="control-input"></select></div>
                                <div class="font-control-item"><label for="main-font-size">字号</label><input type="range" id="main-font-size" min="12" max="24" step="1"><span id="main-font-size-value" class="font-size-value">16px</span></div>
                            </div>
                            <div class="font-control-group">
                                <h4>3D日记本字体</h4>
                                <div class="font-control-item"><label for="book-font-select">字体</label><select id="book-font-select" class="control-input"></select></div>
                                <div class="font-control-item"><label for="book-font-size">字号</label><input type="range" id="book-font-size" min="14" max="28" step="1"><span id="book-font-size-value" class="font-size-value">18px</span></div>
                            </div>
                             <h4>添加新字体</h4>
                             <p style="font-size: 14px; color: var(--c-text-2);">从外部链接 (如 Google Fonts) 导入。请提供字体的 CSS 链接。</p>
                            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                                <input type="text" id="custom-font-name-input" class="control-input" placeholder="字体名称 (可选)">
                                <input type="url" id="custom-font-url-input" class="control-input" placeholder="字体的 CSS 链接 (https://...)" style="flex: 2;">
                                <button id="add-custom-font-btn" class="btn btn-secondary">添加</button>
                            </div>
                            <ul id="custom-font-list" style="list-style: none; padding: 0;"></ul>
                        </div>
                        <!-- 显示偏好面板 -->
                        <div id="settings-display" class="settings-panel hidden">
                           <h4>显示偏好</h4>
                           <div style="display: flex; flex-direction: column; gap: 16px;">
                                <div><label style="font-weight: 500;">时间格式</label><div style="display:flex; gap: 16px; margin-top: 8px;"><label><input type="radio" name="timeFormat" value="relative"> 相对时间</label><label><input type="radio" name="timeFormat" value="full"> 完整时间</label></div></div>
                                <div><label style="font-weight: 500;">日记排序</label><div style="display:flex; gap: 16px; margin-top: 8px;"><label><input type="radio" name="sortOrder" value="newest"> 最新在前</label><label><input type="radio" name="sortOrder" value="oldest"> 最早在前</label></div></div>
                           </div>
                        </div>
                        <!-- 数据管理面板 -->
                        <div id="settings-data" class="settings-panel hidden">
                            <h4>数据管理</h4>
                            <div style="display: flex; flex-direction: column; gap: 16px;">
                                <button id="export-data-btn" class="btn btn-secondary">导出数据</button>
                                <button id="import-data-btn" class="btn btn-secondary">导入数据</button>
                                <input type="file" id="import-file-input" class="hidden" accept=".json">
                                <button id="clear-all-data-btn" class="btn" style="background-color: var(--c-danger); color: white;">清除所有数据...</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-settings-btn" class="btn btn-primary">保存设置</button>
            </div>
        </div>
    </div>
    
    <!-- 其他模态框和浮动元素 -->
    <div id="clear-data-modal" class="modal-overlay">...</div>
    <div id="welcome-modal" class="modal-overlay">...</div>

    <div id="toast-container"></div>
    <button id="scroll-to-top-btn" class="icon-btn" title="回到顶部">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
    </button>
    
    <script src="script.js"></script>
</body>
</html>
